{% extends 'admin/base.html.twig' %}
{% block title %}Modifier {{ user.prenom }} {{ user.nom }} - Admin SitMyPet{% endblock %}
{% block page_title %}Modifier un utilisateur{% endblock %}

{% block content %}

{# ===== PAGE HEADER ===== #}
<div class="page-header">
    <h2>✏️ Modifier l'utilisateur</h2>
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{{ path('app_admin_dashboard') }}">Dashboard</a>
            </li>
            <li class="breadcrumb-item">
                <a href="{{ path('app_admin_user_index') }}">Utilisateurs</a>
            </li>
            <li class="breadcrumb-item">
                <a href="{{ path('app_admin_user_show', {'id': user.id}) }}">
                    {{ user.prenom }} {{ user.nom }}
                </a>
            </li>
            <li class="breadcrumb-item active">Modifier</li>
        </ol>
    </nav>
</div>

<div class="row justify-content-center">
    <div class="col-lg-8">

        {# ===== INFOS UTILISATEUR EN HAUT ===== #}
        <div class="data-card mb-4 p-3">
            <div class="d-flex align-items-center gap-3">
                <div class="user-avatar"
                     style="width:50px; height:50px; font-size:1.1rem; border-radius:12px;
                            background:{% if user.role == 'ROLE_ADMIN' %}#e53935{% elseif user.role == 'ROLE_PROPRIETAIRE' %}#4f7942{% else %}#1976d2{% endif %};">
                    {{ user.prenom|first|upper }}{{ user.nom|first|upper }}
                </div>
                <div>
                    <div class="fw-bold" style="color:#2d3748;">
                        {{ user.prenom }} {{ user.nom }}
                    </div>
                    <div style="font-size:0.8rem; color:#90a4ae;">
                        Inscrit le {{ user.createdAt ? user.createdAt|date('d/m/Y à H:i') : '-' }}
                        · ID #{{ user.id }}
                    </div>
                </div>
                <div class="ms-auto">
                    {% if user.role == 'ROLE_ADMIN' %}
                        <span class="badge-role badge-admin">Admin</span>
                    {% elseif user.role == 'ROLE_PROPRIETAIRE' %}
                        <span class="badge-role badge-proprietaire">Propriétaire</span>
                    {% elseif user.role == 'ROLE_GARDIEN' %}
                        <span class="badge-role badge-gardien">Gardien</span>
                    {% endif %}
                </div>
            </div>
        </div>

        {# ===== FORMULAIRE ===== #}
        <div class="form-card">

            {{ form_start(form, {'attr': {'novalidate': 'novalidate'}}) }}

            {# INFOS PERSONNELLES #}
            <div class="form-section-title">
                <i class="fas fa-user"></i> Informations personnelles
            </div>

            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label class="form-label">Prénom *</label>
                    {{ form_widget(form.prenom, {'attr': {'class': 'form-control'}}) }}
                    {{ form_errors(form.prenom) }}
                </div>
                <div class="col-md-6">
                    <label class="form-label">Nom *</label>
                    {{ form_widget(form.nom, {'attr': {'class': 'form-control'}}) }}
                    {{ form_errors(form.nom) }}
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">Email *</label>
                {{ form_widget(form.email, {'attr': {'class': 'form-control'}}) }}
                {{ form_errors(form.email) }}
            </div>

            <div class="mb-3">
                <label class="form-label">Téléphone *</label>
                {{ form_widget(form.telephone, {'attr': {'class': 'form-control'}}) }}
                {{ form_errors(form.telephone) }}
            </div>

            <div class="mb-4">
                <label class="form-label">Adresse <span class="text-muted fw-normal">(optionnel)</span></label>
                {{ form_widget(form.adresse, {'attr': {'class': 'form-control', 'rows': '2'}}) }}
                {{ form_errors(form.adresse) }}
            </div>

            {# ROLE & STATUT #}
            <div class="form-section-title">
                <i class="fas fa-shield-alt"></i> Rôle &amp; Statut
            </div>

            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <label class="form-label">Rôle *</label>
                    {{ form_widget(form.role, {'attr': {'class': 'form-select'}}) }}
                    {{ form_errors(form.role) }}
                </div>
                <div class="col-md-6 d-flex align-items-end">
                    <div class="form-check">
                        {{ form_widget(form.isActive, {'attr': {'class': 'form-check-input'}}) }}
                        <label class="form-check-label fw-bold" for="{{ form.isActive.vars.id }}">
                            Compte actif
                        </label>
                    </div>
                </div>
            </div>

            {# BOUTONS #}
            <div class="d-flex gap-3 mt-4">
                <button type="submit" class="btn btn-save">
                    <i class="fas fa-save me-2"></i> Enregistrer
                </button>
                <a href="{{ path('app_admin_user_show', {'id': user.id}) }}" class="btn-cancel">
                    <i class="fas fa-times me-2"></i> Annuler
                </a>
            </div>

            {{ form_end(form) }}
        </div>
    </div>
</div>

{% endblock %}
